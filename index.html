<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript">
        function popup() {
            var modal = document.getElementById("modal");
            var modal_content = document.getElementById("modal_content");
            modal.style.display = "block";
            modal_content.style.display = "block";
        }

    </script>
    <script type="text/javascript" src="./lib/ml5.min.js"></script>
    <script type="text/javascript" src="./lib/Tone.js"></script>
    <script type="text/javascript" src="velato_programbuilder.js"></script>
    <script type="text/javascript" src="velato_interface.js"></script>
    <script type="text/javascript" src="page_controls.js"></script>
</head>
<body>
<div id="outframe">
    <div id="header">
        <h1>Velato</h1>
        <h2>Program by <a href="javascript:popup();" id="whistling">whistling</a>. A Hands-Free Code Editor by <a href="http://danieltemkin.com" id="danieltemkin">Daniel Temkin</a></h2>
    </div><div class="main">
        <div class="input-stream box">Input Stream
            <div id="incidentals"></div>
        </div>
        <div class="note-program box">
            <div id="currentlySounding">
                Current Note:
                <span id="currNote"></span><br/>
                Current Root Note:
                <span id="rootNote"></span>
            </div>
            <div id="controls">
                <div id="stop" class="button">PAUSE</div>
                <div id="restart" class="button">RESET</div>
                <div id="remove" class="button">UNDO</div>
            </div>
            <div id="error"></div>
            <div style="flex-direction: row; display:flex;">
                <div class="notes_header">Velato Program</div>
                <div class="notes_header">Current Command</div>
            </div>
            <div style="flex-direction: row; display:flex;flex: 100%;">
                <div id="notes"></div>
                <div id="curr_cmd_notes"><span class="exp">Whistle one note to set the root. Then whistle your first command!<br/><br/>Look at the Lexicon to the right for options.</span></div>
            </div>
        </div>
        <div class="text-program box">
            <div id="js-program">JS Program
                <pre><code class="language-javascript" id="program_txt"></code></pre>
            </div>
            <div id="js-output">Program Output
                <div id="output"></div>
            </div>
        </div>
        <div class="instructions box">
            <h2>Lexicon</h2>
            <a href="javascript:popup();">How do I use this?</a>
            <p>Click the play button (&#x23F5;) to hear one or two options in how to sound the notes for this phrase</p>
            <br/>
            <span class="playbutton" onclick="tone('root')"><b>&#x23F5;</b> Play root note</span>
            <h3>Commands</h3>
            <ul>
                <li><span class="playbutton" onclick="tone('7th')"><b>&#x23F5;</b> Undo Last Command</span> 
                    <ul>
                        <li class="note"><span class="int">{7th}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('root root root')"><b>&#x23F5;</b> End Program</span>
                    <ul>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('2nd')"><b>&#x23F5;</b> Change Root note</span>
                    <ul>
                        <li class="note"><span class="int">{2nd}</span><span class="pitch"></span></li>
                        <li>New root note</li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('3rd')"><b>&#x23F5;</b> Let (assignment)</span>
                    <ul>
                        <li class="note"><span class="int">{3rd}</span><span class="pitch"></span></li>
                        <li>Variable as single note</li>
                        <li>Expression</li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('4th')"><b>&#x23F5;</b> Declare variable</span>
                    <ul>
                        <li class="note"><span class="int">{4th}</span><span class="pitch"></span></li>
                        <li>Variable as single note</li>
                    </ul>
                </li>
                <li><span class="ul_head">Blocks (root)</span></li>
                <li><span class="playbutton" onclick="tone('root 3rd')"><b>&#x23F5;</b> End Block marker</span>
                    <ul>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{3rd}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('root 2nd')"><b>&#x23F5;</b> While</span>
                    <ul>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{2nd}</span><span class="pitch"></span></li>
                        <li>Expression</li>
                        <li>Child Commands</li>
                        <li>End Block marker</li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('root 5th')"><b>&#x23F5;</b> If</span>
                    <ul>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{5th}</span><span class="pitch"></span></li>
                        <li>Expression</li>
                        <li>Child Commands</li>
                        <li>End Block marker</li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('root 6th')"><b>&#x23F5;</b> Else</span>
                    <ul>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{6th}</span><span class="pitch"></span></li>
                        <li>Child Commands</li>
                        <li>End Block marker</li>
                    </ul>
                </li>
                <li><span class='ul_head'>I/O (6th)</span></li>
                <li><span class="playbutton" onclick="tone('6th 5th')"><b>&#x23F5;</b>
                Print</span>
                    <ul>
                        <li class="note"><span class="int">{6th}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{5th}</span><span class="pitch"></span></li>
                        <li>Expression</li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('6th 4th')"><b>&#x23F5;</b> Input</span>
                    <ul>
                        <li class="note"><span class="int">{6th}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{4th}</span><span class="pitch"></span></li>
                        <li>Variable name</li>
                    </ul>
                </li>
            </ul>
            <h3>Expressions</h3>
            <p>All expressions end with ")", a "(" is implied at the beginning of each expression</p>
            <ul>
                <li span class="ul_head">Value (1st / root)</li>
                <li><span class="playbutton" onclick="tone('root 2nd')"><b>&#x23F5;</b>
                    Variable</span>
                    <ul>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{2nd}</span><span class="pitch"></span></li>
                        <li>Tone corresponding to that variable</li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('root 5th 5th')"><b>&#x23F5;</b>
                    Positive Int</span>
                    <ul>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{5th}</span><span class="pitch"></span></li>
                        <li>Single note for each digit, avoiding 5th</li>
                        <li>Fifth to mark end of int</li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('root 3rd 5th')"><b>&#x23F5;</b>
                    Negative Int</span>
                    <ul>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{3rd}</span><span class="pitch"></span></li>
                        <li>Single note for each digit, avoiding 5th</li>
                        <li>Fifth to mark end of int</li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('root 4th 5th')"><b>&#x23F5;</b>
                    Char (Unicode)</span>
                    <ul>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{4th}</span><span class="pitch"></span></li>
                        <li>Single note for each digit, avoiding {5th}</li>
                        <li>{5th} to mark end of char</li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('root 6th 5th 5th')"><b>&#x23F5;</b>
                    Positive Float</span>
                    <ul>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{6th}</span><span class="pitch"></span></li>
                        <li>Single note for each digit, avoiding {5th}</li>
                        <li>Fifth to mark decimal point</li>
                        <li>Single note for each digit, avoiding {5th}</li>
                        <li>Fifth to mark end of float</li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('root 7th 5th 5th')"><b>&#x23F5;</b>
                    Negative Float</span>
                    <ul>
                        <li class="note"><span class="int">{root}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{7th}</span><span class="pitch"></span></li>
                        <li>Single note for each digit, avoiding {5th}</li>
                        <li>{5th} to mark decimal point</li>
                        <li>Single note for each digit, avoiding {5th}</li>
                        <li>{5th} to mark end of float</li>
                    </ul>
                </li>
                <li span class="ul_head">Conditional (3rd)</li>
                <li><span class="playbutton" onclick="tone('3rd 2nd')"><b>&#x23F5;</b>
                    Equality (==)</span>
                    <ul>
                        <li class="note"><span class="int">{3rd}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{2nd}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('3rd 3rd')"><b>&#x23F5;</b>
                    Greater Than (&gt;)</span>
                    <ul>
                        <li class="note"><span class="int">{3rd}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{3rd}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('3rd 4th')"><b>&#x23F5;</b>
                    Less Than (&lt;)</span>
                    <ul>
                        <li class="note"><span class="int">{3rd}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{4th}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('3rd 5th')"><b>&#x23F5;</b>
                    NOT</span>
                    <ul>
                        <li class="note"><span class="int">{3rd}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{5th}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('3rd 6th')"><b>&#x23F5;</b>
                    AND</span>
                    <ul>
                        <li class="note"><span class="int">{3rd}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{6th}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('3rd 7th')"><b>&#x23F5;</b>
                    OR</span>
                    <ul>
                        <li class="note"><span class="int">{3rd}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{7th}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li span class="ul_head">Procedural (6th)</li>
                <li><span class="playbutton" onclick="tone('6th 6th')"><b>&#x23F5;</b> (</span>
                    <ul>
                        <li class="note"><span class="int">{6th}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{6th}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('6th 2nd')"><b>&#x23F5;</b> ) </span> -- this ends all expressions
                    <ul>
                        <li class="note"><span class="int">{6th}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{2nd}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li span class="ul_head">Math (5th)</li>
                <li><span class="playbutton" onclick="tone('5th 3rd')"><b>&#x23F5;</b> +</span>
                    <ul>
                        <li class="note"><span class="int">{5th}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{3rd}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('5th 2nd')"><b>&#x23F5;</b> -</span>
                    <ul>
                        <li class="note"><span class="int">{5th}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{2nd}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('5th 5th')"><b>&#x23F5;</b> *</span>
                    <ul>
                        <li class="note"><span class="int">{5th}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{5th}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('5th 4th')"><b>&#x23F5;</b> /</span>
                    <ul>
                        <li class="note"><span class="int">{5th}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{4th}</span><span class="pitch"></span></li>
                    </ul>
                </li>
                <li><span class="playbutton" onclick="tone('5th 6th')"><b>&#x23F5;</b> % (mod)</span>
                    <ul>
                        <li class="note"><span class="int">{5th}</span><span class="pitch"></span></li>
                        <li class="note"><span class="int">{6th}</span><span class="pitch"></span></li>
                    </ul>
                </li>
            </ul>
            <div class="padding"></div>
        </div>
    </div>
</div><div id="modal"><div id="modal_content"><span class="close" id='close'>&times;</span>HOW TO WHISTLE A PROGRAM<br/>
    <p>The input stream to the left shows any sound the interpreter thinks might be a whistle. A note needs to hold for three consecutive appearances in that list before it registers and needs a break of at least one for it to be considered a distinct note. That means that, if you start a note off-key, you can let it drift to the correct pitch before breaking it off; only the last pitch is counted.</p>
    <p>If you are not sure how to sound a command or expression, try the play buttons in the Lexicon. Most combinations have more than one possibility: the sharp vs flat version (or perfect vs diminished) of an interval. The play button will play both.</p>
    <p>The whistling of a Velato program gets easier with practice, but if it proves too difficult, Velato also takes a MIDI file as input.</p>
</div>
</div>
</div><div id="loading_modal"><div id="modal_content">LOADING AUDIO STREAM...</div></div>
</body>
</html>
