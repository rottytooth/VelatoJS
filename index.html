<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript">
        function popup() {
            var modal = document.getElementById("modal");
            var modal_content = document.getElementById("modal_content");
            modal.style.display = "block";
            modal_content.style.display = "block";
        }

    </script>
    <!-- <script type="text/javascript" src="./lib/vexflow.js"></script> -->
    <script type="text/javascript" src="./lib/vextab.dev.js"></script>
    <script type="text/javascript" src="./lib/ml5.min.js"></script>
    <script type="text/javascript" src="./lib/Tone.js"></script>

    <script type="text/javascript" type="module" src="velato_constants.js"></script>
    <script type="text/javascript" type="module" src="velato_token.js"></script>
    <script type="text/javascript" type="module" src="velato_note.js"></script>
    <script type="text/javascript" type="module" src="velato_programbuilder.js"></script>
    <script type="text/javascript" type="module" src="velato_audio_interface.js"></script>
    <script type="text/javascript" type="module" src="page_controls.js"></script>
</head>
<body>
<div id="outframe">
    <div id="header">
        <h1>Velato</h1>
        <h2>Program by <a href="javascript:popup();" id="whistling">whistling</a>. A Hands-Free Code Editor by <a href="http://danieltemkin.com" id="danieltemkin">Daniel Temkin</a>. One of <a href="https://mitpress.mit.edu/9780262553087/forty-four-esolangs/">Forty-Four Esolangs</a>.</h2>
    </div><div class="main">
        <div class="input-stream box">Input Stream
            <div id="incidentals"></div>
        </div>
        <div class="note-program box">
            <div id="currentlySounding">
                Current Note:
                <span id="currNote"></span><br/>
                Current Root:
                <span id="rootNote"></span>
            </div>
            <div id="controls">
                <div id="stop" class="button">PAUSE</div>
                <div id="restart" class="button">RESET</div>
                <div id="remove" class="button">UNDO</div>
            </div>
            <div style="flex-direction: column; display:flex; height:100%;">
                <div class="notes_header">Current Token</div>
                <div id="curr_cmd_notes">
                </div>
                <div id="notes_row1" style="height:20%">
                    <div id="feedback"><span class="exp">Whistle a first note to set the root. Then whistle your first command!<br/>Look at the Lexicon to the right for options.</span></div>
                </div>
                <div id="notes_row2" style="height:60%">
                    <div class="notes_header">Velato Program</div>
                    <div id="velato_program"></div>
                </div>
            </div>
        </div>
        <div class="text-program box">
            <div id="js-program">JS Program
                <pre><code class="language-javascript" id="program_txt"></code></pre>
            </div>
            <div id="js-output">Program Output
                <div id="output"></div>
            </div>
        </div>
        <div class="col4 box">
            <div style="padding-bottom: 20px;">
                <span class="playbutton" onclick="fib_ex()"><b>&#x23F5; Play Fibonacci demo</b></span>
            </div>
            <div class="instructions">
            <h2>Lexicon</h2>
            <a href="javascript:popup();">How do I use this?</a>
            <p>Click the play button (&#x23F5;) to hear one or two options in how to sound the notes for this phrase</p>
            <br/>
            <span class="playbutton" onclick="tone('root')"><b>&#x23F5;</b> Play root note</span>
            <h3>Commands</h3>

            <ul id="cmdlist"></ul>

            <h3>Expressions</h3>
            <p>All expressions end with ")", a "(" is implied at the beginning of each expression</p>

            <ul id="explist"></ul>

            <div class="padding"></div>
        </div>
        </div>
    </div>
</div><div id="modal"><div id="modal_content"><span class="close" id='close'>&times;</span>HOW TO WHISTLE A PROGRAM<br/>
    <p><b>NOTE: If you're using a headset, there's a good chance it is noise-cancelling and will cancel all your whistling!</b></p>
    <p>First, whistle a single note to set the initial key. Until you change key, all intervals will be in terms of that note.</p>
    <p>The input stream to the left shows any sound the interpreter thinks might be a whistle. A note needs to hold for more than half a second (three consecutive appearances in the stream) before it registers. It will not register until it breaks off (for at least 200 milliseconds). That means that, if you start a note off-key, you can let it drift to the correct pitch; just hold the final note for a moment.</p>
    <p>If you are not sure how to sound a command or expression, try the play buttons in the Lexicon. Most combinations have more than one possibility: major/minor or perfect/diminished. The play button will play both.</p>
    <p>The whistling of a Velato program gets easier with practice, and it may help keep you in tune!</p>
</div>
</div>
</div><div id="loading_modal"><div id="modal_content">LOADING AUDIO STREAM...</div></div>
</body>
</html>
